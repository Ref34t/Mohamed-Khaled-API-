(()=>{"use strict";const e=window.wp.blocks,a=window.React,t=window.wp.i18n,l=window.wp.blockEditor,n=window.wp.components,i=window.wp.element,r=JSON.parse('{"UU":"mohamed-khaled/api-data-table"}');(0,e.registerBlockType)(r.UU,{edit:function({attributes:e,setAttributes:r}){const{columnVisibility:o={}}=e,[s,c]=(0,i.useState)(null),[m,d]=(0,i.useState)(!0),[p,u]=(0,i.useState)(null),[h,w]=(0,i.useState)([]),k=(e=!1)=>{d(!0),u(null);const a=new FormData;a.append("action",window.mkap_ajax.action),a.append("nonce",window.mkap_ajax.nonce),e&&a.append("force_refresh","true"),fetch(window.mkap_ajax.ajax_url,{method:"POST",body:a}).then(e=>e.json()).then(e=>{if(e.success&&e.data){if(c(e.data),e.data.rows&&e.data.rows.length>0){const a=Object.keys(e.data.rows[0]);if(w(a),0===Object.keys(o).length){const e={};a.forEach(a=>{e[a]=!0}),r({columnVisibility:e})}}}else u(e.data?.message||(0,t.__)("Failed to fetch data","mohamed-khaled-api-plugin"))}).catch(()=>{u((0,t.__)("Network error occurred","mohamed-khaled-api-plugin"))}).finally(()=>{d(!1)})};(0,i.useEffect)(()=>{k()},[]);const b=(0,l.useBlockProps)({className:"mkap-data-table-block-editor"});return(0,a.createElement)(a.Fragment,null,(0,a.createElement)(l.InspectorControls,null,(0,a.createElement)(n.PanelBody,{title:(0,t.__)("Table Settings","mohamed-khaled-api-plugin"),initialOpen:!0},(0,a.createElement)("div",{className:"mkap-inspector-controls"},(0,a.createElement)(n.Button,{variant:"secondary",onClick:()=>k(!0),disabled:m,className:"mkap-refresh-button"},m?(0,t.__)("Refreshing...","mohamed-khaled-api-plugin"):(0,t.__)("Refresh Data","mohamed-khaled-api-plugin")),h.length>0&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)("h4",null,(0,t.__)("Column Visibility","mohamed-khaled-api-plugin")),h.map(e=>(0,a.createElement)(n.ToggleControl,{key:e,label:e.charAt(0).toUpperCase()+e.slice(1).replace(/_/g," "),checked:!1!==o[e],onChange:a=>((e,a)=>{r({columnVisibility:{...o,[e]:a}})})(e,a)})))))),(0,a.createElement)("div",{...b},(0,a.createElement)("div",{className:"mkap-block-header"},(0,a.createElement)("h3",null,(0,t.__)("API Data Table","mohamed-khaled-api-plugin")),m&&(0,a.createElement)(n.Spinner,null)),p&&(0,a.createElement)(n.Notice,{status:"error",isDismissible:!1},p),!m&&!p&&(()=>{if(!s||!s.rows||0===s.rows.length)return(0,a.createElement)("div",{className:"mkap-preview-message"},(0,a.createElement)("p",null,(0,t.__)("No data available to display.","mohamed-khaled-api-plugin")));const e=Object.keys(s.rows[0]).filter(e=>!1!==o[e]);return(0,a.createElement)("div",{className:"mkap-table-preview"},(0,a.createElement)("table",{className:"mkap-data-table"},(0,a.createElement)("thead",null,(0,a.createElement)("tr",null,e.map(e=>(0,a.createElement)("th",{key:e},e.charAt(0).toUpperCase()+e.slice(1).replace(/_/g," "))))),(0,a.createElement)("tbody",null,s.rows.slice(0,5).map((t,l)=>(0,a.createElement)("tr",{key:l},e.map(e=>(0,a.createElement)("td",{key:e},String(t[e]||""))))))),s.rows.length>5&&(0,a.createElement)("p",{className:"mkap-preview-note"},(0,t.__)("Preview showing first 5 rows. Full table will display on frontend.","mohamed-khaled-api-plugin")))})()))}})})();